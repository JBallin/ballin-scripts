#!/bin/bash

# TODO:
  # function that takes a filename and reads the gist using 'gist -r'
    # function to display names of the files?
  # INIT:
    # log in to gist
    # create gist and save id in config
  # gu should upload ballin_config too - that way have a backup of ur config
  # give error if id/sn null or if gist -r $id gives error?
    # need to make sure that the gist with that $id actually exists...tell them to run init?
    # or maybe just run it for them now?

id=$(ballin_config get gu.id)
url="https://gist.github.com/$id"

if [ $1 == open ]; then
  echo $url
  open $url
else if $1 == read; then
  if $2; then
    gist -r $id $2
  else
    echo "INVALID: 'read' needs a filename"
  fi
else if $1 == help; then
  ballin
else
  gu
fi


gu() {
  u() {
    local file_name=$1
    local input=$2
    gist_is_changed() {
      gist -r $id $file_name > raw_gist
      local changed
      if cmp --quiet $file_name raw_gist; then
        echo "✔ $file_name"
        changed=1
      else
        echo "✙ $file_name"
        changed=0
      fi
      rm raw_gist
      return $changed
    }

    $input > $file_name
    if gist_is_changed; then gist -u $id $file_name > /dev/null; fi
    rm $file_name
  }

	(
		cd $HOME
	  u 'bash_profile' 'cat .bash_profile'
	  u 'brew_list' 'brew list'
	  u 'brew_leaves' 'brew leaves'
	  u 'brew_cask' 'brew cask list'
	  u 'npm_global' 'ls /usr/local/lib/node_modules'
	  u 'brew_services' 'brew services list'
		u 'gitignore_global' 'cat .gitignore_global'
		u 'gitconfig' 'cat .gitconfig'
    u 'apm' 'apm list --installed --no-color'
		# u 'atomconfig' 'cat .atom/config.cson'
		u 'bash_completions' 'ls /usr/local/etc/bash_completion.d'
	)
}
